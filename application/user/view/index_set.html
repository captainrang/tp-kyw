{extend name="index_base" /}
      {block name="seo"}
        <title>用户设置|{$site_config['site_title']}|{$site_config['seo_title']}</title>
  
  
  <meta name="keywords" content="{$site_config['seo_keyword']}">
  <meta name="description" content="{$site_config['seo_description']}">
      {/block}
{block name="body"}
<style >
 .user-set{
  background-color: rgb(251,251,251)!important;
}
.user-set li a{
  color: #0C0C0C !important;
}
.tab-this a{
  background-color: rgb(23,179,241 ) !important;;
}
.tab-this a>i{
  color: white !important;
}
 .user-set li a:hover{
   background-color: rgba(23,179,241 ,0.7) !important;;
 }
  button{
  background-color: rgb(23,179,241) !important;
    border-radius: 5px !important;
  }
  .panel-user{
    padding: 0 20px!important;
  }
</style>
<div class="fly-user-main">
    <ul class="layui-nav layui-nav-tree layui-inline user-set"  lay-filter="user"  >
    <li class="layui-nav-item">
      <a href="{:url('index/home',array('id'=>$uid))}">
        &nbsp;<i class="iconfont">&#xe609;</i>
        我的主页
      </a>
    </li>
    <li class="layui-nav-item">
      <a href="{:url('index/topic')}">
        &nbsp;<i class=" iconfont">&#xe62d;</i>
        我的帖子
      </a>
    </li>
     <li class="layui-nav-item">
      <a href="{:url('index/comment')}">
        &nbsp;<i class="iconfont">&#xe644;</i>
        我的回复
      </a>
    </li>
    <li class="layui-nav-item">
      <a href="{:url('index/message')}">
        &nbsp;<i class="iconfont">&#xe61b;</i>
        我的通知
      </a>
    </li>
    <li class="layui-nav-item layui-this tab-this" >
      <a href="{:url('index/set')}"  style="color: white !important;">
        &nbsp;<i class="iconfont">&#xe65f;</i>
        基本设置
      </a>
    </li>
    
  </ul>
  
  <div class="site-tree-mobile layui-hide">
    <i class="layui-icon">&#xe602;</i>
  </div>
  <div class="site-mobile-shade"></div>
  
  <div class="fly-panel fly-panel-user panel-user"  >
    <div class="layui-tab layui-tab-brief" lay-filter="user">
      <ul class="layui-tab-title" id="LAY_mine">
        <li class="layui-this" lay-id="info">我的资料</li>
        <li lay-id="avatar">头像</li>
        <li lay-id="pass">密码</li>
        <li lay-id="photowall">照片墙</li>
      </ul>
      <div class="layui-tab-content" style="padding: 20px 0;">
        <div class="layui-form layui-form-pane layui-tab-item layui-show">
          <form method="post">
            <div class="layui-form-item">
              <label for="L_email1" class="layui-form-label">邮箱</label>
              <div class="layui-input-inline">
                <input type="text" id="L_email1" name="usermail" required lay-verify="email" autocomplete="off"  value="{$tptc.usermail}"  class="layui-input">

              </div>
               <div class="layui-form-mid layui-word-aux" id="yzemail">如果您需要变更邮箱，需
              <a href="javascript:;" style="font-size: 12px; color: #4f99cf;"  id="rejhemail">重新验证邮箱</a>。</div>
            </div>
            <div class="layui-form-item">
              <label for="L_username" class="layui-form-label">昵称</label>
              <div class="layui-input-inline">
                <input type="text" id="L_username" name="username" required lay-verify="required" value="{$tptc.username}"  autocomplete="off" value="" class="layui-input">
              </div>
              <div class="layui-inline">
                <div class="layui-input-inline">
                 <input type="radio" name="sex" value="1" title="男" {if condition="$tptc['sex'] eq 1"}checked{/if}>
					  <input type="radio" name="sex" value="0" title="女" {if condition="$tptc['sex'] eq 0"}checked{/if}>
                </div>
              </div>
            </div>
            <div class="layui-form-item">
              <label for="L_city" class="layui-form-label">城市</label>
              <div class="layui-input-inline">
                <input type="text" id="L_city" name="userhome" value="{$tptc.userhome}"  autocomplete="off" value="" class="layui-input">
              </div>
            </div>
            <div class="layui-form-item layui-form-text">
              <label for="L_sign" class="layui-form-label">签名</label>
              <div class="layui-input-block">
                <textarea placeholder="随便写些什么刷下存在感" id="L_sign"  name="description" autocomplete="off" class="layui-textarea" style="height: 80px;">{$tptc.description}</textarea>
              </div>
            </div>
            <div class="layui-form-item">
              <button class="layui-btn" key="set-mine"  lay-filter="user_set" lay-submit ='' >确认修改</button>
            </div>
          </div>
          
          <div class="layui-form layui-form-pane layui-tab-item">
        <form method="post">
			<div class="layui-form-item">
              <div class="avatar-add">
                <p>建议尺寸168*168，支持jpg、png、gif，最大不能超过50KB</p>
                <div class="upload-img">
                  <button type="button" class="layui-btn" id="image">
                    <i class="layui-icon">&#xe67c;</i>上传头像
                  </button>
	              <input type="hidden" name="userhead" value="{$tptc.userhead}" class="layui-input">
                </div>
                <img id="headedit" src="../../../index.php">
              </div>
            </div>
			<div class="layui-form-item">
            <button class="layui-btn" lay-submit="" lay-filter="user_headedit">确认修改</button>
            </div>
			</form>
          </div>
          
          <div class="layui-form layui-form-pane layui-tab-item">
            <form  method="post">
              <div class="layui-form-item">
                <label for="L_nowpass1" class="layui-form-label">当前密码</label>
                <div class="layui-input-inline">
                  <input type="password" id="L_nowpass1" name="nowpass" required lay-verify="required" autocomplete="off" class="layui-input">
                </div>
              </div>
              <div class="layui-form-item">
                <label for="L_pass1" class="layui-form-label">新密码</label>
                <div class="layui-input-inline">
                  <input type="password" id="L_pass1" name="password" required lay-verify="required" autocomplete="off" class="layui-input">
                </div>
                <div class="layui-form-mid layui-word-aux">6到16个字符</div>
              </div>
              <div class="layui-form-item">
                <label for="L_repass1" class="layui-form-label">确认密码</label>
                <div class="layui-input-inline">
                  <input type="password" id="L_repass1" name="confirm_password" required lay-verify="required" autocomplete="off" class="layui-input">
                </div>
              </div>
              <div class="layui-form-item">
                <button class="layui-btn" key="set-mine"  lay-filter="user_setedit" lay-submit>确认修改</button>
              </div>
            </form>
          </div>
        <div class="layui-form layui-form-pane layui-tab-item" >
          <form method="post">
            <div class="layui-form-item" style="background-color:rgb(242,242,245);width:  95%">
              <div class="avatar-add">
                <p>建议尺寸1100*300，支持jpg、png、gif</p>
                <div class="upload-img">
                  <button type="button" class="layui-btn" id="photowall">
                    <i class="layui-icon">&#xe67c;</i>上传照片墙
                  </button>
                  <input type="hidden" name="photowall" value="{$tptc.photowall}" class="layui-input">
                </div>
                <!--<img id="photo-wall" width="80%" height="50%" src="{$tptc.photowall| }">-->
                {if condition="$tptc.photowall eq  ''"}
                <img  class="photo-wall"  style="border-radius: 0px; width: 200px; height: 100px"  } src="__PUBLIC__/images/nopic.png"
                  {else/}   <img class="photo-wall"  style="border-radius: 0px; width: 800px; height: 200px;position: relative;left: 50px"  } src="../../../index.php"
                {/if}>
              </div>
            </div>
            <div class="layui-form-item">
              <button class="layui-btn" lay-submit="" lay-filter="user_photoedit">确认修改</button>
            </div>
          </form>
        </div>
        </div>

      </div>
    </div>
  </div>
<script src="__PUBLIC__/js/common.js"></script>

{/block}
{block name="script"}
<script>

layui.use(['form', 'upload', 'element'],function(){
  var form = layui.form
  ,element = layui.element
  ,jq = layui.jquery
  ,upload = layui.upload;
var n=1;
  jq('.site-tree-mobile').click(function(){
	  
	  if( n==2){
		  jq('.layui-nav').animate({left: '-300px'}, "fast");
		 jq(this).find('.layui-icon').html('&#xe602;');
		  n=1;
	  }else{
		  n=2;
		  jq('.layui-nav').animate({left: '0px'}, "fast");
		  jq(this).find('.layui-icon').html('&#xe603;');
	  }
  });

    upload.render({
        url: '{:url("admin/upload/upimage")}'
        , elem: '#photowall'
        , exts: 'jpg|png|jpeg'
        , before: function (input) {
            loading = layer.load(2, {
                shade: [0.2, '#000']
            });
        }
        , done: function (res) {
            layer.close(loading);
            jq('input[name=photowall]').val(res.path);
            layer.msg(res.msg, {icon: 1, time: 1000});
            jq('.photo-wall').attr('src',getRootPath_web()+res.path);
            jq('.photo-wall').css({
                'width':'800px',
                'height':'200px',
                'position': 'relative',
                'left': '50px'

            })
        }, error: function () {
            layer.close(loading);
            layer.msg('上传出错：1', {
                title: '提示'
                //不自动关闭
                , time: 1000
                , icon: 5
                , offset: '400px'
            });
        }
    });

    upload.render({
        url: '{:url("admin/upload/upimage")}'
        , elem: '#image'
        , exts: 'jpg|png|gif'
        , before: function (input) {
            loading = layer.load(2, {
                shade: [0.2, '#000']
            });
        }
        , done: function (res) {
            layer.close(loading);
            jq('input[name=userhead]').val(res.path);
            layer.msg(res.msg, {icon: 1, time: 1000});
            jq('#headedit').attr('src',getRootPath_web()+res.path);
        }, error: function () {
            layer.close(loading);
            layer.msg('上传出错：1', {
                title: '提示'
                //不自动关闭
                , time: 1000
                , icon: 5
                , offset: '400px'
            });
        }
    });
  var emailold='';
  
  jq('#rejhemail').click(function(){
	  //重新激活邮箱后，去掉disable,然后传送email的参数
		//  var id= jq(this).data('id');
	  	var url="{:url('user/index/resetmail')}";

		  var reemail=jq('#L_email1').val();
		  if(reemail==emailold){
			  layer.msg('请更改邮箱进行验证', {icon: 2, anim: 6, time: 1000});
		  }else{
			  jq.post(url,{'email':reemail},function(data){
			      if(data.code == 200){
			        layer.msg(data.msg, {icon: 1, time: 1000}, function(){
			        	 jq('#L_email').attr('disabled','disabled');
			        	 jq('#yzemail').html('邮件已经发出！请查收')
			        });
			      }else{
			        layer.msg(data.msg, {icon: 2, anim: 6, time: 1000});
			      }
			    });
		  }
	  
 });
  
  

  form.on('submit(user_set)', function(data){
      if (jq('#L_email1').val()!='{$tptc.usermail}') {
          layer.msg('请先验证新邮箱！', {icon: 2, time: 1000}, function(){
          });
          return false;
      }
    loading = layer.load(2, {
      shade: [0.2,'#000']
    });
    var param = data.field;
    jq.post('{:url("user/index/set")}',param,function(data){
      if(data.code == 200){
        layer.close(loading);
        layer.msg(data.msg, {icon: 1, time: 1000}, function(){

        });
      }else{
        layer.close(loading);
        layer.msg(data.msg, {icon: 2, anim: 6, time: 1000});
      }
    });
    return false;
  });

  form.on('submit(user_setedit)', function(data){
    loading = layer.load(2, {
      shade: [0.2,'#000']
    });
    var param = data.field;
    jq.post('{:url("user/index/setedit")}',param,function(data){
      if(data.code == 200){
        layer.close(loading);
        layer.msg(data.msg, {icon: 1, time: 1000}, function(){
          location.href = '{:url("user/index/set")}';
        });
      }else{
        layer.close(loading);
        layer.msg(data.msg, {icon: 2, anim: 6, time: 1000});
      }
    });
    return false;
  });

  form.on('submit(user_headedit)', function(data){
    loading = layer.load(2, {
      shade: [0.2,'#000']
    });
    console.log(data);
    var param = data.field;
    jq.post('{:url("user/index/headedit")}',param,function(data){
      if(data.code == 200){
        layer.close(loading);
        layer.msg(data.msg, {icon: 1, time: 1000}, function(){
          location.href = '{:url("user/index/set")}';
        });
      }else{
        layer.close(loading);
        layer.msg(data.msg, {icon: 2, anim: 6, time: 1000});
      }
    });
    return false;
  });

    form.on('submit(user_photoedit)', function(data){
        loading = layer.load(2, {
            shade: [0.2,'#000']
        });
        console.log(data);
        var param = data.field;
        jq.post('{:url("user/index/photoedit")}',param,function(data){
            if(data.code == 200){
                layer.close(loading);
                layer.msg(data.msg, {icon: 1, time: 1000}, function(){
                    location.href = '{:url("user/index/set")}';
                });
            }else{
                layer.close(loading);
                layer.msg(data.msg, {icon: 2, anim: 6, time: 1000});
            }
        });
        return false;
    });
});
</script>{/block}